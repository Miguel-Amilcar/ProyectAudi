@{
    Layout = null;

    var ctrl = (ViewContext.RouteData.Values["controller"]
                ?? ViewContext.RouteData.Values["Controller"]
                ?? "").ToString().ToLower();

    var seguridadActiva = ctrl == "usuarios" || ctrl == "roles" || ctrl == "permisos" || ctrl == "rol_permisos";
    var credencialesActiva = ctrl == "crear_contraseñas" || ctrl == "ver_contraseñas";
    var correosActiva = ctrl == "usuariosparacorreo" || ctrl == "redactarcorreo" || ctrl == "correosenviados";
    var gestionCorreosActiva = correosActiva;
    var configuracionActiva = ctrl == "configuracion" || gestionCorreosActiva;

    var rolId = Context.Session.GetInt32("RolId");
}

<aside class="dashboard-sidebar" id="sidebar" role="navigation" aria-label="Navegación principal">
    <div class="sidebar-title">Módulos</div>
    <nav class="sidebar-nav">
        <a asp-controller="Home" asp-action="Index"
           class="nav-item @(ctrl == "home" ? "is-active" : "")"
           aria-current="@(ctrl == "home" ? "page" : null)">
            <i class="bi bi-house-door"></i><span>Inicio</span>
        </a>

        <div class="nav-item submenu-toggle" onclick="toggleCredenciales()">
            <i class="bi bi-key"></i><span>Credenciales</span>
        </div>
        <ul id="credenciales-submenu" class="submenu @(credencialesActiva ? "" : "oculto")">
            <li>
                <a asp-controller="Crear_Contraseñas" asp-action="Index"
                   class="nav-item @(ctrl == "crear_contraseñas" ? "is-active" : "")">
                    <i class="bi bi-pencil-square"></i><span>Gestión de Credenciales</span>
                </a>
            </li>
            @if (rolId == 1)
            {
                <li>
                    <a asp-controller="Ver_Contraseñas" asp-action="Index"
                       class="nav-item @(ctrl == "ver_contraseñas" ? "is-active" : "")">
                        <i class="bi bi-eye"></i><span>Ver Contraseñas</span>
                    </a>
                </li>
            }
        </ul>

        <a asp-controller="Auditoria" asp-action="Index"
           class="nav-item @(ctrl == "auditoria" ? "is-active" : "")"
           aria-current="@(ctrl == "auditoria" ? "page" : null)">
            <i class="bi bi-activity"></i><span>Auditoría</span>
        </a>

        <div class="nav-item submenu-toggle" onclick="toggleSeguridad()">
            <i class="bi bi-shield-lock"></i><span>Gestión de Seguridad</span>
        </div>
        <ul id="seguridad-submenu" class="submenu @(seguridadActiva ? "" : "oculto")">
            <li>
                <a asp-controller="Usuarios" asp-action="Index" class="nav-item @(ctrl == "usuarios" ? "is-active" : "")">
                    <i class="bi bi-person"></i><span>Usuarios</span>
                </a>
            </li>
            <li>
                <a asp-controller="Roles" asp-action="Index" class="nav-item @(ctrl == "roles" ? "is-active" : "")">
                    <i class="bi bi-shield"></i><span>Roles</span>
                </a>
            </li>
            @if (rolId == 1)
            {
                <li>
                    <a asp-controller="Rol_permisos" asp-action="SeleccionarRol"
                       class="nav-item @(ctrl == "rol_permisos" ? "is-active" : "")">
                        <i class="bi bi-list-check"></i><span>Asignar Permisos a Rol</span>
                    </a>
                </li>
            }
        </ul>

        @if (rolId == 1)
        {
            <div class="nav-item submenu-toggle" onclick="toggleConfiguracion()">
                <i class="bi bi-gear"></i><span>Configuración</span>
            </div>
            <ul id="configuracion-submenu" class="submenu @(configuracionActiva ? "" : "oculto")">
                <li class="nav-item submenu-toggle" onclick="toggleGestionCorreos()">
                    <i class="bi bi-envelope"></i><span>Notificar cambios por correo</span>
                </li>
                <ul id="gestion-correos-submenu" class="submenu @(gestionCorreosActiva ? "" : "oculto")">
                    <li>
                        <a asp-controller="Correos" asp-action="UsuariosParaCorreo"
                           class="nav-item @(ctrl == "usuariosparacorreo" ? "is-active" : "")">
                            <i class="bi bi-person-lines-fill"></i><span>Usuarios para correo</span>
                        </a>
                    </li>
      @*               <li>
                        <a asp-controller="Correos" asp-action="EnviarCorreo"
                           class="nav-item @(ctrl == "redactarcorreo" ? "is-active" : "")">
                            <i class="bi bi-pencil"></i><span>Redactar correo</span>
                        </a>
                    </li> *@
                    <li>
                        <a asp-controller="Correos" asp-action="CorreosEnviados"
                           class="nav-item @(ctrl == "correosenviados" ? "is-active" : "")">
                            <i class="bi bi-send-check"></i><span>Correos enviados</span>
                        </a>
                    </li>
                </ul>
            </ul>
        }

        <a asp-controller="Ayuda" asp-action="Index"
           class="nav-item @(ctrl == "ayuda" ? "is-active" : "")"
           aria-current="@(ctrl == "ayuda" ? "page" : null)">
            <i class="bi bi-question-circle"></i><span>Ayuda</span>
        </a>
    </nav>
</aside>

<script>
    function toggleSeguridad() {
        document.getElementById("seguridad-submenu").classList.toggle("oculto");
    }

    function toggleCredenciales() {
        document.getElementById("credenciales-submenu").classList.toggle("oculto");
    }

    function toggleConfiguracion() {
        document.getElementById("configuracion-submenu").classList.toggle("oculto");
    }

    function toggleGestionCorreos() {
        document.getElementById("gestion-correos-submenu").classList.toggle("oculto");
    }
</script>
